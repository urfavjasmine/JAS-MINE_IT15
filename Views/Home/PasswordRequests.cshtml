@model IEnumerable<JAS_MINE_IT15.Models.PasswordResetRequestViewModel>
@{
    ViewData["Title"] = "Password Reset Requests";
    Layout = "~/Views/Shared/_Layout.cshtml";

    // If Model is null, show sample data so UI still displays
    var requests = (Model ?? new List<JAS_MINE_IT15.Models.PasswordResetRequestViewModel>
    {
        new() { Id=1, Email="juan.delacruz@brgy.gov.ph", Status="Pending",   Requested="2024-01-15 09:30 AM", Notes="Cannot access account" },
        new() { Id=2, Email="maria.santos@brgy.gov.ph",  Status="Approved",  Requested="2024-01-14 02:15 PM", Notes="Password expired" },
        new() { Id=3, Email="pedro.reyes@brgy.gov.ph",   Status="Completed", Requested="2024-01-13 11:00 AM", Notes="Forgot password after leave" },
        new() { Id=4, Email="ana.garcia@brgy.gov.ph",    Status="Rejected",  Requested="2024-01-12 08:45 AM", Notes="Invalid email - not in system" }
    }).ToList();

    int CountStatus(string s) => requests.Count(r => (r.Status ?? "").Equals(s, StringComparison.OrdinalIgnoreCase));
    var pending = CountStatus("Pending");
    var approved = CountStatus("Approved");
    var completed = CountStatus("Completed");
    var rejected = CountStatus("Rejected");
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
    /* page spacing */
    .page-wrap {
        padding: 22px;
    }

    /* header */
    .title {
        font-weight: 800;
        font-size: 26px;
        margin: 0;
        color: #0f172a;
    }

    .subtitle {
        margin: 4px 0 0;
        color: #64748b;
    }

    .btn-new {
        background: #0f2f57;
        border: 0;
        border-radius: 10px;
        padding: 10px 14px;
        font-weight: 700;
    }

    /* stat cards */
    .stat-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(0,1fr));
        gap: 16px;
        margin-top: 16px;
    }

    @@media (max-width: 900px) {
        .stat-grid {
            grid-template-columns: repeat(2, minmax(0,1fr));
        }
    }

    .stat-card {
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        background: #fff;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .stat-icon {
        width: 44px;
        height: 44px;
        border-radius: 999px;
        border: 1px solid #e2e8f0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #64748b;
        font-size: 22px;
    }

    .stat-num {
        font-size: 28px;
        font-weight: 900;
        line-height: 1;
        color: #0f172a;
    }

    .stat-label {
        font-size: 12px;
        color: #64748b;
        margin-top: 2px;
    }

    /* filter row */
    .filter-row {
        display: flex;
        gap: 14px;
        margin: 16px 0;
        align-items: center;
    }

    @@media (max-width: 700px) {
        .filter-row {
            flex-direction: column;
            align-items: stretch;
        }
    }

    .searchbox {
        height: 42px;
        border-radius: 10px;
        border: 1px solid #e2e8f0;
        padding: 0 14px;
        width: 320px;
        max-width: 100%;
    }

    .status-dd {
        height: 42px;
        border-radius: 10px;
        border: 1px solid #e2e8f0;
        padding: 0 12px;
        min-width: 170px;
        background: #fff;
    }

    /* table card */
    .table-card {
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        background: #fff;
        overflow: hidden;
    }

    .table thead th {
        color: #64748b;
        font-size: 13px;
        font-weight: 800;
        background: #fff;
        border-bottom: 1px solid #e2e8f0 !important;
        padding: 16px;
    }

    .table tbody td {
        padding: 18px 16px;
        vertical-align: middle;
        border-top: 1px solid #f1f5f9 !important;
    }

    .muted {
        color: #64748b;
        font-size: 13px;
    }

    /* status badges */
    .badge-soft {
        border-radius: 999px;
        padding: 6px 12px;
        font-weight: 800;
        font-size: 12px;
        border: 1px solid transparent;
        display: inline-block;
    }

    .b-pending {
        background: #fff;
        border-color: #e2e8f0;
        color: #0f172a;
    }

    .b-approved {
        background: #0f2f57;
        color: #fff;
    }

    .b-completed {
        background: #f1f5f9;
        color: #0f172a;
        border-color: #e2e8f0;
    }

    .b-rejected {
        background: #dc2626;
        color: #fff;
    }

    /* actions */
    .action-wrap {
        display: flex;
        justify-content: end;
        gap: 12px;
        align-items: center;
    }

    .btn-approve {
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        padding: 8px 12px;
        background: #fff;
        font-weight: 800;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .icon-btn {
        width: 34px;
        height: 34px;
        border-radius: 10px;
        border: 1px solid transparent;
        background: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0f172a;
    }

        .icon-btn:hover {
            background: #f8fafc;
            border-color: #e2e8f0;
        }

    .icon-danger {
        color: #dc2626;
    }
</style>

<div class="page-wrap">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-start gap-3">
        <div>
            <h1 class="title">Password Reset Requests</h1>
            <div class="subtitle">Manage password reset requests from users</div>
        </div>

        <button class="btn btn-primary btn-new" type="button">
            <i class="bi bi-plus-lg me-2"></i> New Request
        </button>
    </div>

    <!-- Stats -->
    <div class="stat-grid">
        <div class="stat-card" role="button" onclick="quickFilter('Pending')">
            <div class="stat-icon"><i class="bi bi-clock"></i></div>
            <div>
                <div class="stat-num">@pending</div>
                <div class="stat-label">Pending</div>
            </div>
        </div>

        <div class="stat-card" role="button" onclick="quickFilter('Approved')">
            <div class="stat-icon"><i class="bi bi-check2-circle"></i></div>
            <div>
                <div class="stat-num">@approved</div>
                <div class="stat-label">Approved</div>
            </div>
        </div>

        <div class="stat-card" role="button" onclick="quickFilter('Completed')">
            <div class="stat-icon"><i class="bi bi-check-circle"></i></div>
            <div>
                <div class="stat-num">@completed</div>
                <div class="stat-label">Completed</div>
            </div>
        </div>

        <div class="stat-card" role="button" onclick="quickFilter('Rejected')">
            <div class="stat-icon"><i class="bi bi-x-circle"></i></div>
            <div>
                <div class="stat-num">@rejected</div>
                <div class="stat-label">Rejected</div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filter-row">
        <input id="searchBox" class="searchbox" placeholder="Search by email or notes..." oninput="applyFilters()" />
        <select id="statusFilter" class="status-dd" onchange="applyFilters()">
            <option value="All">All Status</option>
            <option value="Pending">Pending</option>
            <option value="Approved">Approved</option>
            <option value="Completed">Completed</option>
            <option value="Rejected">Rejected</option>
        </select>
    </div>

    <!-- Table -->
    <div class="table-card">
        <table class="table mb-0" id="reqTable">
            <thead>
                <tr>
                    <th style="width:28%;">Email</th>
                    <th style="width:14%;">Status</th>
                    <th style="width:18%;">Requested</th>
                    <th>Notes</th>
                    <th style="width:18%; text-align:right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var r in requests)
                {
                    var status = (r.Status ?? "Pending");
                    var badgeClass = status.ToLower() switch
                    {
                                "pending" => "badge-soft b-pending",
                                "approved" => "badge-soft b-approved",
                                "completed" => "badge-soft b-completed",
                                "rejected" => "badge-soft b-rejected",
                        _ => "badge-soft b-pending"
                    };

                    <tr data-status="@status" data-email="@(r.Email?.ToLower() ?? "")" data-notes="@(r.Notes?.ToLower() ?? "")">
                        <td class="fw-semibold">@r.Email</td>
                        <td><span class="@badgeClass">@status</span></td>
                        <td class="muted">@r.Requested</td>
                        <td class="muted">@r.Notes</td>
                        <td>
                            <div class="action-wrap">
                                @if (status.Equals("Pending", StringComparison.OrdinalIgnoreCase))
                                {
                                    <button type="button" class="btn-approve" onclick="approve('@r.Id')">
                                        <i class="bi bi-check2"></i> Approve
                                    </button>
                                }
                                <button type="button" class="icon-btn" onclick="edit('@r.Id')">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button type="button" class="icon-btn icon-danger" onclick="del('@r.Id')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script>
    function quickFilter(status) {
        document.getElementById("statusFilter").value = status;
        applyFilters();
    }

    function applyFilters() {
        const term = (document.getElementById("searchBox").value || "").toLowerCase().trim();
        const status = document.getElementById("statusFilter").value;

        document.querySelectorAll("#reqTable tbody tr").forEach(row => {
            const rStatus = row.getAttribute("data-status");
            const email = row.getAttribute("data-email") || "";
            const notes = row.getAttribute("data-notes") || "";

            const okSearch = !term || email.includes(term) || notes.includes(term);
            const okStatus = (status === "All") || (rStatus === status);

            row.style.display = (okSearch && okStatus) ? "" : "none";
        });
    }

    // UI placeholders (connect to controller later)
    function approve(id) { alert("Approve request ID: " + id); }
    function edit(id) { alert("Edit request ID: " + id); }
    function del(id) {
        if (confirm("Delete this request?")) alert("Delete request ID: " + id);
    }
</script>
